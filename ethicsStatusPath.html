<template>
    <!-- Error state -->
    <template if:true={errorMessage}>
        <div class="slds-m-around_small slds-text-color_error">
            {errorMessage}
        </div>
    </template>

    <!-- Normal state -->
    <template if:true={pathReady}>
        <div class="path-wrapper">

            <!-- SLDS Path -->
            <div class="slds-path" role="application">
                <div class="slds-grid slds-path__track">
                    <div class="slds-grid slds-path__scroller-container">
                        <div class="slds-path__scroller">
                            <div class="slds-path__scroller_inner">
                                <ul class="slds-path__nav" role="listbox" aria-orientation="horizontal">
                                    <template for:each={stages} for:item="stage">
                                        <li key={stage.value} class={stage.cssClass} role="presentation">
                                            <a class="slds-path__link" role="option" aria-selected={stage.isCurrent}>
                                                <span class="slds-path__stage">
                                                    <template if:true={stage.isComplete}>
                                                        <lightning-icon
                                                            icon-name="utility:check"
                                                            size="x-small"
                                                            alternative-text="Complete">
                                                        </lightning-icon>
                                                    </template>
                                                </span>
                                                <span class="slds-path__title">
                                                    {stage.label}
                                                </span>
                                            </a>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guidance for Success -->
            <template if:true={hasGuidance}>
                <article class="slds-card slds-m-top_small guidance-card">
                    <div class="slds-card__header slds-grid">
                        <header class="slds-media slds-media_center slds-has-flexi-truncate">
                            <div class="slds-media__body">
                                <h2 class="slds-card__header-title">
                                    Guidance for Success
                                </h2>
                            </div>
                        </header>
                    </div>
                    <div class="slds-card__body slds-card__body_inner guidance-container">
                        <template if:true={showDraftGuidance}>
                            <p>
                                The eForm will remain locked until a Principal Investigator (PI) is added under Research Personnel.
                                You must also add all other project personnel (Co-Investigators, Student Investigators, Coordinating
                                PIs, Administrators), as these details pre-fill into the eForm.
                            </p>
                            <p>
                                The creator of the application is automatically added as Administrator. Go to the Research Personnel
                                tab, click Edit via the arrow dropdown, and update your role.
                            </p>
                            <p>
                                To add personnel: click Add Research Personnel, enter their LTU email, select Role and Date Added
                                (today) — do not add an End Date — then click Save.
                            </p>
                            <p>To unlock, click Access eForm (top right).</p>
                            <p class="slds-m-bottom_small">Tips:</p>
                            <ul class="slds-list_dotted">
                                <li>PIs cannot be students, honorary, adjunct, affiliate, or CONAGOTH.</li>
                            </ul>
                        </template>

                        <template if:true={showEformGuidance}>
                            <p>
                                The eForm is in draft mode and can be accessed and edited by clicking “Access eForm” at the top
                                right.
                            </p>
                            <p>
                                All listed research personnel and administrators can edit the eForm, but the Principal Investigator
                                must make the final declaration and submission.
                            </p>
                            <p>
                                At this stage, you can still edit the “Research Personnel” and “Ethics Application Title” fields.
                            </p>
                            <p class="slds-m-bottom_small">To Update Research Personnel</p>
                            <ul class="slds-list_dotted">
                                <li>Remove someone: Go to the Research Personnel tab, click the dropdown arrow &gt; Edit, enter an End Date, and Save.</li>
                                <li>Change role: Same steps, but update the Role only (no End Date).</li>
                                <li>Add personnel: Click “Add Research Personnel” (top right).</li>
                            </ul>
                            <p>Tip: Use LTU email for accurate results.</p>
                            <p>Remember to click “Save Draft” before exiting the eForm. You can return and continue editing at any time.</p>
                        </template>

                        <template if:true={showResearchOfficeGuidance}>
                            <p>
                                Your application has been submitted for an initial compliance and governance review by the Research
                                Office.
                            </p>
                            <p>You still have view-only access to your application via the “Access eForm” button at the top right.</p>
                            <p>If you need to make further changes, please contact humanethics@latrobe.edu.au to discuss your options.</p>
                        </template>

                        <template if:true={showResearcherActionsGuidance}>
                            <p>
                                This stage means your application requires updates based on the review. This may occur for one of the
                                following reasons:
                            </p>
                            <ol class="slds-list_ordered slds-m-left_medium">
                                <li>
                                    <strong>Post compliance/governance review</strong> — you may need to:
                                    <ul class="slds-list_dotted slds-m-top_xx-small">
                                        <li>Update any components with the assigned project ID.</li>
                                        <li>Review any supporting documentation provided.</li>
                                        <li>Submit updated documents into your application.</li>
                                        <li>Provide additional information as requested.</li>
                                    </ul>
                                </li>
                                <li class="slds-m-top_small">
                                    <strong>Post committee review</strong> — you may need to:
                                    <ul class="slds-list_dotted slds-m-top_xx-small">
                                        <li>Update your application in line with the specified committee recommendations.</li>
                                        <li>Provide additional supporting documentation.</li>
                                        <li>Complete a different application pathway if required.</li>
                                    </ul>
                                </li>
                            </ol>
                            <p>
                                You will be notified of the specific changes required via email. In some cases, you may need to
                                update the Research Personnel directly in PRIME or amend the eForm by selecting the Access eForm
                                button above. For eForm amendments, please follow the instructions provided in the email.
                            </p>
                        </template>

                        <template if:true={showCommitteeReviewGuidance}>
                            <p>Your application has been assigned to the relevant ethics committee for review.</p>
                        </template>

                        <template if:true={showOpenCommentsGuidance}>
                            <p>Your application is currently under review by the committee.</p>
                            <p>You continue to have view-only access to the eForm during this stage.</p>
                            <p>Tip: You will receive the outcome within seven business days of the committee meeting date.</p>
                        </template>

                        <template if:true={showApprovedGuidance}>
                            <p>Your application has been approved by the ethics committee.</p>
                            <p>
                                You continue to have view-only access to the eForm and all previous committee comments for your
                                reference.
                            </p>
                            <p>
                                If you need to make changes to your approved application, please select “Create Modification” at the
                                top right. This will allow access to an editable version of your application.
                            </p>
                            <p>
                                Tip: To submit post approval reports, please choose from “Create Annual Report,” “Create Final Report,”
                                or “Create UAE/Safety Report” at the top right of the screen to access the form.
                            </p>
                            <p>You will receive the outcome within seven business days of the committee meeting date.</p>
                        </template>

                        <template if:true={showExpiredGuidance}>
                            <p>
                                Your project approval has expired. You are no longer permitted to conduct any research activities under
                                this approved project.
                            </p>
                            <p>
                                If you have not already done so, you must submit a new project within three months of the expiry date.
                            </p>
                            <p>Tip: You will receive the outcome within seven business days of the committee meeting date.</p>
                        </template>

                        <template if:true={showClosedGuidance}>
                            <p>This project has been closed.</p>
                        </template>
                    </div>
                </article>
            </template>

        </div>
    </template>

    <!-- Loading / Builder state -->
    <template if:true={showLoading}>
        <div class="slds-m-around_small slds-text-body_small">
            Loading ethics status path…
        </div>
    </template>
</template>
